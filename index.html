<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>雲井鳴診断｜24問/60問・日本語ポップ版</title>
  <style>
    :root {
      --bg: linear-gradient(180deg,#f6f9ff,#ffffff);
      --fg: #0f172a;
      --muted: #475569;
      --brand: #8f82bc;
      --accent: #6ec5ff;
      --card: #ffffff;
      --border: #e2e8f0;
      --warn: #dc2626;
    }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background: var(--bg); color: var(--fg);}
    .wrap { max-width: 920px; margin: 0 auto; padding: 16px 16px 96px }
    header { display: flex; justify-content: space-between; margin: 12px 0 20px; align-items:flex-start; gap:12px; flex-wrap:wrap;}
    h1 { font-size: 28px; font-weight: 800; background: linear-gradient(90deg,var(--brand),var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin:0 0 6px;}
    .muted { color: var(--muted); font-size: 13px }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 18px; box-shadow: 0 6px 18px rgba(15,23,42,0.08);}
    .card.pad { padding: 20px }
    .progress { height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden }
    .progress>div { height:100%;background:linear-gradient(90deg,var(--brand),var(--accent));width:0%;transition:width .3s ease }
    .q { padding:16px 18px; border-top:1px solid var(--border) }
    .q:first-child { border-top:none }
    .qtitle {font-size:15px; margin:0 0 12px;}
    .slider { display:flex;align-items:center;gap:8px }
    .slider span{font-weight:600;}
    input[type=range]{width:100%;height:36px;accent-color:var(--brand);}
    .btn{border:none;background:var(--brand);color:#fff;padding:10px 16px;border-radius:12px;font-weight:700;cursor:pointer;}
    .btn.ghost{background:#fff;color:var(--brand);border:1px solid var(--brand);}
    .btn:hover{opacity:0.9;}
    .btn.ghost:hover{background:#f1f5f9;}
    .footer{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,0.98);border-top:1px solid var(--border);}
    .footer .inner{max-width:920px;margin:0 auto;padding:10px 16px;display:flex;justify-content:space-between;align-items:center;gap:8px;}
    .result{padding:24px;border-radius:18px;background:#fff;box-shadow:0 8px 20px rgba(0,0,0,0.1);line-height:1.7;}
    .result h2{font-size:24px;margin:0 0 12px;}
    .result h3{margin-top:18px;font-size:18px;border-left:4px solid var(--brand);padding-left:8px;}
    .warn{color:var(--warn);background:#fee2e2;padding:10px 14px;border-radius:10px;margin-top:10px;font-weight:600;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>雲井鳴診断（24問/60問・日本語ポップ版）</h1>
        <div class="muted">日常の質問に答えるだけで、あなたの立ち位置と相性がわかります。回答はブラウザ内のみで処理されます。</div>
      </div>
      <div>
        <button class="btn ghost" id="mode24">24問版</button>
        <button class="btn" id="mode60">60問版</button>
      </div>
    </header>

    <section id="progressCard" class="card pad">
      <div class="progress"><div id="bar"></div></div>
      <div id="count" class="muted">0/0 回答（0%）</div>
    </section>
    <section id="questionCard" class="card" style="margin-top:16px;"></section>
    <section id="resultCard" class="result" style="display:none; margin-top:20px;" data-share=""></section>
    <div id="warnMsg" class="warn"></div>
  </div>

  <div class="footer">
    <div class="inner">
      <span id="modeLabel">24問版</span>
      <div>
        <button id="calcBtn" class="btn">診断する</button>
        <button id="copyBtn" class="btn ghost">結果をコピー</button>
      </div>
    </div>
  </div>

  <script>
/* ===================== 改良版 24問 ===================== */
const Q24 = [
  // E/I（外向―内向）
  {id:'q1',  text:'初対面でも自分から話しかけることが多い。', axis:'EI', polarity:+1},
  {id:'q2',  text:'長時間の交流の後は、一人で休む時間が必要だ。', axis:'EI', polarity:-1},
  {id:'q3',  text:'人と一緒に過ごすとエネルギーが湧いてくる。', axis:'EI', polarity:+1},
  {id:'q4',  text:'静かな環境で過ごす方が落ち着く。', axis:'EI', polarity:-1},

  // N/S（直感―感覚）
  {id:'q5',  text:'出来事の「先の展開」を想像しながら考える。', axis:'NS', polarity:+1}, 
  {id:'q6',  text:'五感（匂い・音・手触り）に敏感だ。', axis:'NS', polarity:-1},         
  {id:'q7',  text:'無関係に見える事柄から関連を見出すことが得意だ。', axis:'NS', polarity:+1}, 
  {id:'q8',  text:'数字や具体的事実を重視しないと不安になる。', axis:'NS', polarity:-1},      

  // T/F（論理―倫理）
  {id:'q9',  text:'論理が破綻していると納得できない。', axis:'TF', polarity:+1}, 
  {id:'q10', text:'公平さやルールの一貫性を優先する。', axis:'TF', polarity:+1}, 
  {id:'q11', text:'人を傷つけないよう表現に気を配る。', axis:'TF', polarity:-1}, 
  {id:'q12', text:'場の雰囲気や空気の変化に敏感だ。', axis:'TF', polarity:-1},   

  // J/P（計画性―柔軟性）
  {id:'q13', text:'週の初めに予定を立てておくと安心する。', axis:'JP', polarity:+1},
  {id:'q14', text:'締切は前倒しで終わらせたい。', axis:'JP', polarity:+1},
  {id:'q15', text:'新しい情報が入れば計画をすぐに変えられる。', axis:'JP', polarity:-1},
  {id:'q16', text:'旅先ではその場の流れで動くのが楽しい。', axis:'JP', polarity:-1},

  // 機能系（Ni/Ne/Si/Se/Ti/Te/Fi/Fe）
  {id:'q17', text:'未来を「必然の流れ」として予感することが多い。', axis:'Ni', polarity:+1},
  {id:'q18', text:'アイデアを次々に思いつき、人に投げかけるのが好きだ。', axis:'Ne', polarity:+1},
  {id:'q19', text:'快適な環境（温度・音・光）がないと集中しにくい。', axis:'Si', polarity:+1},
  {id:'q20', text:'緊張した場面で自然と主導権を握ることがある。', axis:'Se', polarity:+1},
  {id:'q21', text:'概念や定義をきちんと整理したくなる。', axis:'Ti', polarity:+1},
  {id:'q22', text:'効率的な仕組みを考えるのが得意だ。', axis:'Te', polarity:+1},
  {id:'q23', text:'相手の価値観を尊重して接することが大切だと思う。', axis:'Fi', polarity:+1},
  {id:'q24', text:'自分の感情表現が場の雰囲気を左右すると思う。', axis:'Fe', polarity:+1},
];

/* ===================== 改良版 60問 ===================== */
const Q60 = [
  // E/I
  {id:'q1',  text:'予定のない休日、人と会う約束があると嬉しい。', axis:'EI', polarity:+1},
  {id:'q2',  text:'長時間の交流の後は一人で休む時間が必要だ。', axis:'EI', polarity:-1},
  {id:'q3',  text:'初対面でも積極的に話しかけられる。', axis:'EI', polarity:+1},
  {id:'q4',  text:'静かに一人で過ごす方がエネルギーを回復できる。', axis:'EI', polarity:-1},
  {id:'q5',  text:'大人数での雑談やイベントは楽しい。', axis:'EI', polarity:+1},
  {id:'q6',  text:'会議や集まりの後はどっと疲れることが多い。', axis:'EI', polarity:-1},

  // N/S
  {id:'q7',  text:'出来事の背後にある流れや未来を考えることが多い。', axis:'Ni', polarity:+1},
  {id:'q8',  text:'新しいモノを見ると応用や未来像を想像する。', axis:'Ne', polarity:+1},
  {id:'q9',  text:'数字や事実を根拠に判断するのを好む。', axis:'S', polarity:+1},
  {id:'q10', text:'五感（匂い・温度・手触り）に敏感だ。', axis:'Si', polarity:+1},
  {id:'q11', text:'無関係に見える事柄から関連性を見出すのが得意だ。', axis:'Ne', polarity:+1},
  {id:'q12', text:'「未来の必然性」を直感的に感じることがある。', axis:'Ni', polarity:+1},
  {id:'q13', text:'デザインや道具の細部にこだわる。', axis:'Si', polarity:+1},
  {id:'q14', text:'環境の変化（音・光）で気分が大きく変わる。', axis:'Si', polarity:+1},

  // T/F
  {id:'q15', text:'議論では論理の整合性を最優先する。', axis:'Ti', polarity:+1},
  {id:'q16', text:'効率や成果を重視して判断する。', axis:'Te', polarity:+1},
  {id:'q17', text:'人の気持ちを大切にして結論を出す。', axis:'Fi', polarity:+1},
  {id:'q18', text:'場の雰囲気に合わせて行動を変える。', axis:'Fe', polarity:+1},
  {id:'q19', text:'原因を徹底的に分析する。', axis:'Ti', polarity:+1},
  {id:'q20', text:'数値で成果を測ることを好む。', axis:'Te', polarity:+1},
  {id:'q21', text:'仲間の価値観を尊重して対応する。', axis:'Fi', polarity:+1},
  {id:'q22', text:'自分の感情表現で場を盛り上げる。', axis:'Fe', polarity:+1},

  // J/P
  {id:'q23', text:'週の初めに予定が埋まっていると安心する。', axis:'JP', polarity:+1},
  {id:'q24', text:'締切は前倒しで終わらせたい。', axis:'JP', polarity:+1},
  {id:'q25', text:'旅は行き当たりばったりで決めたい。', axis:'JP', polarity:-1},
  {id:'q26', text:'直前に計画を変えても平気だ。', axis:'JP', polarity:-1},
  {id:'q27', text:'机やファイルを体系的に整理するのが好きだ。', axis:'JP', polarity:+1},
  {id:'q28', text:'予定は柔軟に動かせる方が安心する。', axis:'JP', polarity:-1},
  {id:'q29', text:'ToDoを優先度順に並べることが多い。', axis:'JP', polarity:+1},
  {id:'q30', text:'計画をあまり細かく決めずに進めたい。', axis:'JP', polarity:-1},

  // 機能強化
  {id:'q31', text:'長期的な視点で物事を考えることが多い。', axis:'Ni', polarity:+1},
  {id:'q32', text:'未来のビジョンを語るのが得意だ。', axis:'Ni', polarity:+1},
  {id:'q33', text:'思いついたアイデアを次々広げていく。', axis:'Ne', polarity:+1},
  {id:'q34', text:'新しい可能性を人に提示するのが好きだ。', axis:'Ne', polarity:+1},
  {id:'q35', text:'快適さや居心地を重視して行動する。', axis:'Si', polarity:+1},
  {id:'q36', text:'体調やコンディションに敏感だ。', axis:'Si', polarity:+1},
  {id:'q37', text:'プレッシャーの場面で自然と主導権を握る。', axis:'Se', polarity:+1},
  {id:'q38', text:'対立場面で強気に出やすい。', axis:'Se', polarity:+1},
  {id:'q39', text:'理屈や定義が曖昧だと気になる。', axis:'Ti', polarity:+1},
  {id:'q40', text:'仕組みを整理して理解するのが得意。', axis:'Ti', polarity:+1},
  {id:'q41', text:'効率化の方法を考えるのが好き。', axis:'Te', polarity:+1},
  {id:'q42', text:'成果や数値で評価されたい。', axis:'Te', polarity:+1},
  {id:'q43', text:'人との距離感を大事にする。', axis:'Fi', polarity:+1},
  {id:'q44', text:'相手の価値観を尊重して判断する。', axis:'Fi', polarity:+1},
  {id:'q45', text:'場を盛り上げると自分も楽しくなる。', axis:'Fe', polarity:+1},
  {id:'q46', text:'感情を共有して雰囲気を高めたい。', axis:'Fe', polarity:+1},

  // 補助・差別化用
  {id:'q47', text:'ルールの一貫性に強くこだわる。', axis:'Ti', polarity:+1},
  {id:'q48', text:'今この瞬間の感覚を大切にする。', axis:'Si', polarity:+1},
  {id:'q49', text:'周囲のモチベーションに影響されやすい。', axis:'Fe', polarity:+1},
  {id:'q50', text:'相手の弱点をすぐに見抜いてしまう。', axis:'Se', polarity:+1},
  {id:'q51', text:'抽象的な理論より具体的な実績を信じる。', axis:'Te', polarity:+1},
  {id:'q52', text:'相手の信念や価値観を尊重する。', axis:'Fi', polarity:+1},
  {id:'q53', text:'未来よりも現在を楽しむ方が大切だ。', axis:'Si', polarity:+1},
  {id:'q54', text:'困難な場面でリーダーシップを発揮しやすい。', axis:'Se', polarity:+1},
  {id:'q55', text:'抽象理論を深く考えるのが好き。', axis:'Ti', polarity:+1},
  {id:'q56', text:'効率を求めてシステムを改善するのが得意。', axis:'Te', polarity:+1},
  {id:'q57', text:'人間関係の中で信念を大事にする。', axis:'Fi', polarity:+1},
  {id:'q58', text:'雰囲気を読んで行動することが多い。', axis:'Fe', polarity:+1},
  {id:'q59', text:'新しいことに挑戦して刺激を求める。', axis:'Ne', polarity:+1},
  {id:'q60', text:'一つの未来像に集中して考え込む。', axis:'Ni', polarity:+1},
];
/* ===================== タイプ定義 ===================== */
const TYPES = {
  IEE:{name:'アイデア冒険家', cluster:'アイデアマン型', perspective:'アイデア視点', quadra:'Delta'},
  IEI:{name:'夢見る共感者', cluster:'夢語り型', perspective:'ドラマティック視点', quadra:'Beta'},
  EIE:{name:'ドラマティック演出家', cluster:'盛り上げ役型', perspective:'ドラマティック視点', quadra:'Beta'},
  EII:{name:'お人好し仲裁役', cluster:'癒し型', perspective:'調和視点', quadra:'Delta'},
  ILE:{name:'ひらめき発明家', cluster:'アイデアマン型', perspective:'アイデア視点', quadra:'Alpha'},
  LII:{name:'理屈マスター', cluster:'参謀型', perspective:'ルール視点', quadra:'Alpha'},
  LIE:{name:'戦略プランナー', cluster:'参謀型', perspective:'アイデア視点', quadra:'Gamma'},
  ILI:{name:'未来予報士', cluster:'夢語り型', perspective:'ルール視点', quadra:'Gamma'},
  ESE:{name:'場を盛り上げ隊長', cluster:'ムードメーカー型', perspective:'主役視点', quadra:'Alpha'},
  ESI:{name:'正義の番人', cluster:'守り役型', perspective:'ルール視点', quadra:'Gamma'},
  SEE:{name:'カリスマ配信者', cluster:'ムードメーカー型', perspective:'主役視点', quadra:'Gamma'},
  SLE:{name:'ゴーゴー行動派', cluster:'盛り上げ役型', perspective:'主役視点', quadra:'Beta'},
  SEI:{name:'ゆるふわ癒し役', cluster:'癒し型', perspective:'調和視点', quadra:'Alpha'},
  LSE:{name:'段取りマネージャー', cluster:'段取り型', perspective:'ルール視点', quadra:'Delta'},
  LSI:{name:'ルール番長', cluster:'段取り型', perspective:'ルール視点', quadra:'Beta'},
  SLI:{name:'マイペース職人', cluster:'守り役型', perspective:'調和視点', quadra:'Delta'},
};

/* ===================== 相性定義 ===================== */
const REL = {
  IEE:{dual:{name:'マイペース職人',desc:'落ち着きがIEEのアイデアを現実に定着させる'},
       same:[{name:'段取りマネージャー',desc:'現実的視点で補完し合える'},{name:'お人好し仲裁役',desc:'人間関係重視で安心できる'}],
       conflict:{name:'ルール番長',desc:'厳格さが自由奔放なIEEと衝突しやすい'}},
  IEI:{dual:{name:'ゴーゴー行動派',desc:'行動力がIEIの夢想を現実に引き上げる'},
       same:[{name:'ドラマティック演出家',desc:'Betaクアドラで共感・演出が噛み合う'},{name:'ルール番長',desc:'厳格さと感情表現の組合せで場を締める'}],
       conflict:{name:'段取りマネージャー',desc:'計画重視で感情的なIEIと対立しやすい'}},
  EIE:{dual:{name:'ルール番長',desc:'冷静で規律あるLSIがEIEの情熱を安定させる'},
       same:[{name:'夢見る共感者',desc:'Betaクアドラで感情と未来を共に語れる'},{name:'ゴーゴー行動派',desc:'勢いあるSLEと一緒に盛り上げ役を担える'}],
       conflict:{name:'マイペース職人',desc:'消極的なSLIとEIEの情熱は噛み合いにくい'}},
  EII:{dual:{name:'カリスマ配信者',desc:'華やかなSEEがEIIの誠実さを引き出す'},
       same:[{name:'段取りマネージャー',desc:'安定を大切にする仲間として相性が良い'},{name:'マイペース職人',desc:'落ち着いたSLIと互いに安心感を得られる'}],
       conflict:{name:'ゴーゴー行動派',desc:'強引なSLEと衝突しやすい'}},
  ILE:{dual:{name:'ゆるふわ癒し役',desc:'SEIの柔らかさがILEの発想を支える'},
       same:[{name:'理屈マスター',desc:'理論でアイデアを整理してくれる'},{name:'場を盛り上げ隊長',desc:'明るさで発明を楽しく広げてくれる'}],
       conflict:{name:'正義の番人',desc:'倫理観を重んじるESIと対立しやすい'}},
  LII:{dual:{name:'場を盛り上げ隊長',desc:'社交的なESEがLIIの理屈を和らげる'},
       same:[{name:'ひらめき発明家',desc:'自由な発想を理論で支える'},{name:'ゆるふわ癒し役',desc:'穏やかに理論を補完してくれる'}],
       conflict:{name:'カリスマ配信者',desc:'華やかなSEEと現実的理屈が噛み合わない'}},
  LIE:{dual:{name:'正義の番人',desc:'倫理観あるESIがLIEの戦略を安定させる'},
       same:[{name:'未来予報士',desc:'長期的な視点を共有できる'},{name:'理屈マスター',desc:'論理を補完し合える参謀関係'}],
       conflict:{name:'ゆるふわ癒し役',desc:'穏やかなSEIと成果志向のLIEはかみ合いにくい'}},
  ILI:{dual:{name:'カリスマ配信者',desc:'SEEの行動力がILIの未来予測を実現に結びつける'},
       same:[{name:'正義の番人',desc:'堅実さを共有できる'},{name:'戦略プランナー',desc:'成果志向を共に語れる'}],
       conflict:{name:'場を盛り上げ隊長',desc:'明るいESEと慎重なILIは温度差が大きい'}},
  ESE:{dual:{name:'理屈マスター',desc:'LIIの論理がESEの明るさを支える'},
       same:[{name:'ひらめき発明家',desc:'新しい企画を楽しく広げられる'},{name:'ゆるふわ癒し役',desc:'安心感を与え合える'}],
       conflict:{name:'未来予報士',desc:'慎重すぎるILIと勢いのESEはすれ違いやすい'}},
  ESI:{dual:{name:'戦略プランナー',desc:'LIEの成果志向とESIの誠実さがかみ合う'},
       same:[{name:'未来予報士',desc:'堅実さを共有できる'},{name:'理屈マスター',desc:'理論と倫理のバランスが良い'}],
       conflict:{name:'ひらめき発明家',desc:'自由奔放なILEと衝突しやすい'}},
  SEE:{dual:{name:'未来予報士',desc:'ILIの冷静な視点がSEEの情熱を補う'},
       same:[{name:'正義の番人',desc:'道徳的視点で共感できる'},{name:'戦略プランナー',desc:'成果を重視する仲間'}],
       conflict:{name:'理屈マスター',desc:'LIIの理屈に窮屈さを感じやすい'}},
  SLE:{dual:{name:'夢見る共感者',desc:'IEIの感性がSLEの勢いを和らげる'},
       same:[{name:'ドラマティック演出家',desc:'Betaクアドラの盛り上げ役仲間'},{name:'ルール番長',desc:'統率力を共有できる'}],
       conflict:{name:'お人好し仲裁役',desc:'調和を重んじるEIIと衝突しやすい'}},
  SEI:{dual:{name:'ひらめき発明家',desc:'ILEの発想をSEIが穏やかにサポートする'},
       same:[{name:'場を盛り上げ隊長',desc:'明るさを共有できる'},{name:'理屈マスター',desc:'論理を柔らかく包んでくれる'}],
       conflict:{name:'戦略プランナー',desc:'成果優先のLIEと柔らかいSEIはすれ違う'}},
  LSE:{dual:{name:'夢見る共感者',desc:'IEIの感性をLSEの段取りで支える'},
       same:[{name:'お人好し仲裁役',desc:'調和を保ちながら現実性を持てる'},{name:'マイペース職人',desc:'安定した進行を共有できる'}],
       conflict:{name:'ドラマティック演出家',desc:'情熱的すぎるEIEと衝突しやすい'}},
  LSI:{dual:{name:'ドラマティック演出家',desc:'EIEの情熱をLSIが秩序で支える'},
       same:[{name:'夢見る共感者',desc:'Betaクアドラで感情を共有できる'},{name:'ゴーゴー行動派',desc:'勢いを持つ仲間'}],
       conflict:{name:'アイデア冒険家',desc:'奔放なIEEにストレスを感じやすい'}},
  SLI:{dual:{name:'アイデア冒険家',desc:'IEEの発想をSLIの堅実さで形にできる'},
       same:[{name:'段取りマネージャー',desc:'計画を安定させる仲間'},{name:'お人好し仲裁役',desc:'人間関係重視で調和できる'}],
       conflict:{name:'ドラマティック演出家',desc:'EIEの情熱を持て余しやすい'}},
};

<script>
/* ===================== タイプ詳細（全16タイプ・省略なし） ===================== */
const DETAIL = {
  // --- IEI ---
  IEI: {
    intro: "未来を物語として語り、人の感情を優しくすくい上げる感受性の持ち主。雰囲気を大切にし、場に安心感をもたらします。",
    strength: ["感情に敏感で共感力が高い","芸術的センス","未来像を語れる","雰囲気を和ませる","安心感を与える"],
    weak: ["現実タスクが苦手","優柔不断","プレッシャーに弱い","対立回避で先送り","主導者に萎縮"],
    vtuber: ["ASMR","朗読・歌枠","世界観重視の雑談"],
    role: "ストーリーテラー／雰囲気担当",
    variants: {
      dreamer: "幻想的な発想が際立つ『ドリーマー型』。",
      empath: "人の心に寄り添う『共感者型』。",
      artist: "芸術的表現に長けた『アーティスト型』。"
    }
  },

  // --- IEE ---
  IEE: {
    intro: "人やアイデアを縦横無尽につなぐ冒険者。次々に新しい企画を生み出す存在です。",
    strength: ["出会いから発想を得る","流行に敏感","社交的で柔軟","巻き込み力が高い","ネットワーク作りが得意"],
    weak: ["管理が苦手","集中が続かない","実行力不足","興味が移りやすい","情熱が拡散しやすい"],
    vtuber: ["参加型配信","突発コラボ","ゲストトーク"],
    role: "アイデアマン／種まき役",
    variants: {
      connector: "人脈を広げる『コネクター型』。",
      explorer: "新しい刺激を求める『冒険家型』。",
      catalyst: "場を変えるきっかけを作る『触媒型』。"
    }
  },

  // --- EIE ---
  EIE: {
    intro: "情熱を舞台に変える演出家。感情を操り、物語を演出するカリスマ性を持ちます。",
    strength: ["ストーリーテリング","感情表現で人を動かす","カリスマ性","共感を引き出す","鼓舞力"],
    weak: ["感情的で疲れやすい","論理に弱い","ドラマを盛りすぎる","管理が苦手","冷静さ不足"],
    vtuber: ["歌枠","演出企画","物語実況"],
    role: "演出担当／ムードシェイパー",
    variants: {
      orator: "説得力に富む『オレーター型』。",
      director: "物語を仕立てる『ディレクター型』。",
      motivator: "人を奮い立たせる『モチベーター型』。"
    }
  },

  // --- EII ---
  EII: {
    intro: "誠実で温厚な仲裁役。人の気持ちを尊重し、調和を保つ橋渡し役です。",
    strength: ["誠実さと信頼感","仲裁力","共感力","長期関係を重視","道徳心"],
    weak: ["意思表示が弱い","主導できない","遠慮がち","感情に流されやすい","融通が利かない"],
    vtuber: ["お悩み相談","共感雑談","仲裁コラボ"],
    role: "仲裁役／裏方サポート",
    variants: {
      counselor: "相談役の『カウンセラー型』。",
      mediator: "対立を和らげる『メディエーター型』。",
      guardian: "信頼を守り抜く『ガーディアン型』。"
    }
  },

  // --- ILE ---
  ILE: {
    intro: "自由奔放で好奇心旺盛な発明家。新しい可能性を見つけ出し、場に驚きを生みます。",
    strength: ["発想力豊か","柔軟性の高さ","論理と直感の融合","幅広い興味","仕掛け人"],
    weak: ["飽きやすい","実行力不足","深掘り前に次へ飛びつく","リスク管理が甘い","収拾がつかなくなる"],
    vtuber: ["新作実況","実験企画","ネタ枠配信"],
    role: "ネタ出し／発明家",
    variants: {
      trickster: "突拍子もない『トリックスター型』。",
      tinkerer: "実験を楽しむ『ティンカー型』。",
      innovator: "未来志向の『イノベーター型』。"
    }
  },

  // --- LII ---
  LII: {
    intro: "冷静沈着な理屈の参謀。複雑な事象を分析・整理し、体系化する頭脳型タイプです。",
    strength: ["分析力","理論体系化","客観性","批判的思考","精度の高い計画"],
    weak: ["感情に疎い","頑固","細部に固執","空気を読みにくい","人間関係軽視"],
    vtuber: ["解説配信","考察動画","検証企画"],
    role: "冷静参謀／まとめ役",
    variants: {
      analyst: "論理を追求する『アナリスト型』。",
      architect: "全体構造を設計する『アーキテクト型』。",
      judge: "公平さを大切にする『ジャッジ型』。"
    }
  },

  // --- LIE ---
  LIE: {
    intro: "未来を見据え、成果を出すことに全力を注ぐ戦略家。",
    strength: ["戦略性","大局観","実行力","成果志向","ビジネス感覚"],
    weak: ["冷徹に見られる","感情配慮が弱い","柔軟性不足","速度感がズレる","短期関係を軽視"],
    vtuber: ["企画立案","長期的プロジェクト配信"],
    role: "戦略参謀／プロデューサー",
    variants: {
      strategist: "未来を見据える『ストラテジスト型』。",
      producer: "進行を管理する『プロデューサー型』。",
      commander: "突破力で導く『コマンダー型』。"
    }
  },

  // --- ILI ---
  ILI: {
    intro: "未来を予測し、慎重に動く観察者。冷静な洞察力でリスクを管理する賢者です。",
    strength: ["未来予測","リスク管理","冷静な論理性","観察眼","長期視点"],
    weak: ["行動が遅い","悲観的","柔軟性不足","即応性に欠ける","流れに乗れない"],
    vtuber: ["考察配信","解説動画","シナリオ分析"],
    role: "冷静参謀／未来予報",
    variants: {
      prophet: "未来を読み解く『予言者型』。",
      observer: "静かに観察する『オブザーバー型』。",
      critic: "リスクを見抜く『クリティック型』。"
    }
  },

  // --- ESE ---
  ESE: {
    intro: "明るさと社交性で場を支配するエンターテイナー。",
    strength: ["明るさで和ませる","初対面に強い","場を盛り上げる","感情キャッチ","サービス精神旺盛"],
    weak: ["論理が苦手","感情に振り回されやすい","瞬間重視","主導しすぎる","疲れやすい"],
    vtuber: ["雑談","歌枠","イベントMC"],
    role: "司会進行／場の中心",
    variants: {
      entertainer: "人を楽しませる『エンターテイナー型』。",
      host: "気配り上手な『ホスト型』。",
      spark: "空気を一変させる『スパーク型』。"
    }
  },

  // --- ESI ---
  ESI: {
    intro: "誠実さと倫理観で仲間を守る守護者。",
    strength: ["誠実さと一貫性","倫理観の高さ","守護意識","忠誠心","関係管理能力"],
    weak: ["批判的になりやすい","柔軟性不足","保守的","主観的判断が強い","挑戦に消極的"],
    vtuber: ["ルール系配信","真面目対談","監督役"],
    role: "守護者／秩序の番人",
    variants: {
      guardian: "忠誠心の強い『ガーディアン型』。",
      critic: "批判的に判断する『クリティック型』。",
      loyalist: "信頼を重んじる『ロイヤリスト型』。"
    }
  },

  // --- SEE ---
  SEE: {
    intro: "豪快で華やかなカリスマ。自信に満ちたパフォーマンスで人を魅了します。",
    strength: ["カリスマ性","瞬発力","豪快さ","巻き込み力","自信あるパフォーマンス"],
    weak: ["持続力不足","調整が苦手","衝突を恐れない","ルール嫌い","反発しやすい"],
    vtuber: ["アイドル活動","歌ってみた","ファンイベント"],
    role: "メインスター／ムード支配者",
    variants: {
      idol: "注目を浴びる『アイドル型』。",
      leader: "前に出て牽引する『リーダー型』。",
      challenger: "挑戦を恐れない『チャレンジャー型』。"
    }
  },

  // --- SLE ---
  SLE: {
    intro: "勢いと突破力で状況を切り拓くアクションリーダー。",
    strength: ["即断即決","勇敢さ","突破力","リーダーシップ","勢い"],
    weak: ["計画不足","衝突を招きやすい","リスク管理が甘い","感情配慮に欠ける","協調性が低い"],
    vtuber: ["挑戦企画","対戦ゲーム","体当たり系配信"],
    role: "切り込み隊長／アクション担当",
    variants: {
      warrior: "戦いに挑む『ウォリアー型』。",
      pioneer: "新しい道を切り開く『パイオニア型』。",
      enforcer: "押し進める『エンフォーサー型』。"
    }
  },

  // --- SEI ---
  SEI: {
    intro: "柔らかく穏やかな癒し手。居心地の良さを提供する存在です。",
    strength: ["雰囲気を和ませる","聞き上手","安心感を与える","快適さを大切にする","柔らかい接し方"],
    weak: ["受け身","決断力不足","主導性が弱い","長期展望に弱い","流されやすい"],
    vtuber: ["ASMR","雑談","癒し枠"],
    role: "雰囲気担当／聞き役",
    variants: {
      healer: "人を癒す『ヒーラー型』。",
      companion: "寄り添う『コンパニオン型』。",
      comforter: "快適さを重視する『コンフォーター型』。"
    }
  },

  // --- LSE ---
  LSE: {
    intro: "現実的で計画的な段取り上手。安定進行に優れる。",
    strength: ["計画遂行力","リソース管理","責任感","安定進行","信頼感"],
    weak: ["柔軟性不足","理想に弱い","型にはまりやすい","融通が利かない","遊び心不足"],
    vtuber: ["定期配信","進行・運営企画","整理術コンテンツ"],
    role: "進行管理／裏方リーダー",
    variants: {
      manager: "進行を守る『マネージャー型』。",
      organizer: "整理整頓に長けた『オーガナイザー型』。",
      steward: "責任を重んじる『スチュワード型』。"
    }
  },

  // --- LSI ---
  LSI: {
    intro: "規律と正確さを重んじる監督役。",
    strength: ["正確性と几帳面さ","秩序維持","統率力","責任感","安定感"],
    weak: ["柔軟性不足","新奇性に弱い","厳格すぎる","感情に疎い","批判的になりやすい"],
    vtuber: ["大会運営","検証枠","ルール解説配信"],
    role: "審判役／秩序の要",
    variants: {
      strict: "秩序を徹底する『ストリクト型』。",
      supportive: "仲間を支える『サポーター型』。",
      tactical: "状況を読む『タクティカル型』。"
    }
  },

  // --- SLI ---
  SLI: {
    intro: "忍耐強くコツコツ積み上げる職人気質。安定した努力で成果を出すタイプ。",
    strength: ["継続力","職人気質","落ち着き","安定感","実務力"],
    weak: ["消極的","社交性が低い","頑固","新しい挑戦に消極的","人間関係に疎い"],
    vtuber: ["ものづくり配信","作業ASMR","検証レビュー"],
    role: "職人枠／安定要員",
    variants: {
      craftsman: "努力家の『クラフツマン型』。",
      stabilizer: "落ち着きを重んじる『スタビライザー型』。",
      minimalist: "無駄を嫌う『ミニマリスト型』。"
    }
  }
};

/* ===================== アルゴリズム & UI制御（完全版） ===================== */
/* 依存: Q24, Q60, TYPES, REL, DETAIL がすでに定義済みであること */

/* ---------- 参照プロファイル（軸ベクトル） ---------- */
/* ※ 値は相対ベクトル（大きいほどその極に寄る）。軸: EI, NS, TF, JP */
const TYPE_PROFILES = {
  IEI: {EI:-3, NS:+4, TF:-2, JP:-1},
  IEE: {EI:+3, NS:+3, TF:-1, JP:-2},
  EIE: {EI:+4, NS:+2, TF:-3, JP:+1},
  EII: {EI:-2, NS:+2, TF:-4, JP:+1},
  ILE: {EI:+2, NS:+4, TF:+2, JP:-2},
  LII: {EI:-3, NS:+3, TF:+4, JP:+2},
  LIE: {EI:+1, NS:+3, TF:+4, JP:+3},
  ILI: {EI:-4, NS:+4, TF:+3, JP:-2},
  ESE: {EI:+4, NS:-1, TF:-3, JP:+2},
  ESI: {EI:-2, NS:-1, TF:-4, JP:+3},
  SEE: {EI:+4, NS:+1, TF:-2, JP:-3},
  SLE: {EI:+4, NS:+1, TF:+2, JP:-3},
  SEI: {EI:-3, NS:-2, TF:-2, JP:-2},
  LSE: {EI:+1, NS:-1, TF:+3, JP:+4},
  LSI: {EI:-2, NS:-2, TF:+4, JP:+3},
  SLI: {EI:-4, NS:-3, TF:+1, JP:-1},
};

/* ---------- 重み設定 ---------- */
const WEIGHTS = {
  EI: 1.2,
  NS: 1.2,
  TF: 1.2,
  JP: 1.2,
  functions: 1.5,   // 機能(Ni/Ne/Si/Se/Ti/Te/Fi/Fe)の重み
  correction: 1.15  // 機能補正係数ベース
};

/* ---------- 集計（軸 & 機能） ---------- */
function computeAxes() {
  const ax = {EI:0, NS:0, TF:0, JP:0};
  const func = {Ni:0,Ne:0,Si:0,Se:0,Ti:0,Te:0,Fi:0,Fe:0};
  const counts = {EI:0,NS:0,TF:0,JP:0,Ni:0,Ne:0,Si:0,Se:0,Ti:0,Te:0,Fi:0,Fe:0};

  current.forEach(q=>{
    const val = answers[q.id];
    if(val===undefined) return;
    if (ax.hasOwnProperty(q.axis)) {
      const w = WEIGHTS[q.axis] || 1;
      ax[q.axis] += val * q.polarity * w;
      counts[q.axis] += w;
    } else if (func.hasOwnProperty(q.axis)) {
      const w = WEIGHTS.functions;
      func[q.axis] += val * q.polarity * w;
      counts[q.axis] += w;
} else if (q.axis === 'S') {
  const w = WEIGHTS.NS;
  ax.NS -= val * q.polarity * w;  // ← マイナスで積む
  counts.NS += w;
}
  });

  // 正規化
  for (const k of Object.keys(ax)) if (counts[k]>0) ax[k] /= counts[k];
  for (const k of Object.keys(func)) if (counts[k]>0) func[k] /= counts[k];

  return {ax, func};
}

/* ---------- 軸→MBTI確率合成 → ソシオニクス型マップ ---------- */
function pickType({ax, func}) {
  function decideAxis(v, pos, neg) {
    // 強い確信域（±1超）では片側に寄せる
    if (v > 1)  return {[pos]: 1};
    if (v < -1) return {[neg]: 1};
    // 中間域は線形確率
    const prob = (v + 1) / 2; // v∈[-1,1] → [0,1]
    return {[pos]: prob, [neg]: 1 - prob};
  }
  const ei = decideAxis(ax.EI, 'E','I');
  const ns = decideAxis(ax.NS, 'N','S');
  const tf = decideAxis(ax.TF, 'T','F');
  const jp = decideAxis(ax.JP, 'J','P');

  // 全組み合わせ（16通り）
  const combos = [];
  for (const e in ei) for (const n in ns) for (const t in tf) for (const j in jp) {
    combos.push({key: e+n+t+j, score: ei[e]*ns[n]*tf[t]*jp[j]});
  }

  // MBTI→ソシオニクス近似マップ
  const MAP = {
    ENFP:'IEE', INFP:'IEI', ENFJ:'EIE', INFJ:'EII',
    ENTP:'ILE', INTJ:'LII', ENTJ:'LIE', INTP:'ILI',
    ESFJ:'ESE', ISFJ:'ESI', ESFP:'SEE', ESTP:'SLE',
    ISFP:'SEI', ESTJ:'LSE', ISTJ:'LSI', ISTP:'SLI'
  };

  // ---------- 機能補正（Ni/Se, Ne/Si, Ti/Fe, Te/Fi の相対を使う） ----------
  // 強い側を強化、対極を減衰（スコアに乗算）
  const c = WEIGHTS.correction;
  const inv = 1/WEIGHTS.correction;

  const boosts = [];
  if (func.Ni - func.Se > 0.15) boosts.push({has:'N', lacks:'S'});
  if (func.Se - func.Ni > 0.15) boosts.push({has:'S', lacks:'N'});

  if (func.Ne - func.Si > 0.15) boosts.push({has:'N', lacks:'S'});
  if (func.Si - func.Ne > 0.15) boosts.push({has:'S', lacks:'N'});

  if (func.Ti - func.Fe > 0.15) boosts.push({has:'T', lacks:'F'});
  if (func.Fe - func.Ti > 0.15) boosts.push({has:'F', lacks:'T'});

  if (func.Te - func.Fi > 0.15) boosts.push({has:'T', lacks:'F'});
  if (func.Fi - func.Te > 0.15) boosts.push({has:'F', lacks:'T'});

  const combos2 = combos.map(cmb=>{
    let s = cmb.score;
    for (const b of boosts) {
      if (cmb.key.includes(b.has))  s *= c;
      if (cmb.key.includes(b.lacks)) s *= inv;
    }
    return {...cmb, score:s};
  });

  // MBTI→ Socionics tally
  const tally = {};
  for (const cmb of combos2) {
    const soc = MAP[cmb.key] || 'IEE';
    tally[soc] = (tally[soc] || 0) + cmb.score;
  }
  return Object.entries(tally).map(([key,score])=>({key,score}));
}

/* ---------- コサイン類似度 & ベクトル診断 ---------- */
function cosineSim(v1, v2) {
  let dot=0, n1=0, n2=0;
  for (const k of Object.keys(v1)) {
    const a = v1[k]||0, b = v2[k]||0;
    dot += a*b; n1 += a*a; n2 += b*b;
  }
  return dot / (Math.sqrt(n1)*Math.sqrt(n2) + 1e-9);
}

function vectorDiagnosis(ax) {
  const sims = Object.keys(TYPE_PROFILES).map(k=>{
    const sim = cosineSim(ax, TYPE_PROFILES[k]);
    return {key:k, score: sim};
  });
  return sims.sort((a,b)=>b.score-a.score);
}

/* ---------- 信頼度（上位2候補の比率） ---------- */
function computeConfidence(candidates) {
  if (candidates.length < 2) return "Low";
  const [a,b] = candidates;
  const ratio = a.score / (a.score + b.score + 1e-9);
  if (ratio > 0.64) return "High";
  if (ratio > 0.55) return "Medium";
  return "Low";
}

/* ---------- 統合ビルド ---------- */
function buildResult() {
  const {ax, func} = computeAxes();
  const candAxis = pickType({ax, func});
  const candVec  = vectorDiagnosis(ax);

  // スコア合算（正規化は不要：相対比較用。単純加算）
  const tally = {};
  candAxis.forEach(c => { tally[c.key] = (tally[c.key]||0) + c.score; });
  candVec.forEach(c  => { tally[c.key] = (tally[c.key]||0) + c.score; });

  const candidates = Object.entries(tally).map(([key,score])=>({key,score}))
                      .sort((a,b)=>b.score-a.score);

  const topKey = candidates[0].key;
  const t = TYPES[topKey], rel = REL[topKey], d = DETAIL[topKey];
  const confidence = computeConfidence(candidates);

  lastResult = { t, rel, d, ax, func, tKey: topKey, candidates, confidence };
  // コピー用テキストを生成
  const share =
`【雲井鳴診断】
あなたは「${t.name}」タイプ（${topKey}）

${d.intro}

🌟 強み
- ${d.strength.join("\n- ")}

⚠️ 弱み
- ${d.weak.join("\n- ")}

🤝 相性
デュアル: ${rel.dual.name} — ${rel.dual.desc}
同クアドラ:
${rel.same.map(x=>"・"+x.name+" — "+x.desc).join("\n")}
コンフリクト: ${rel.conflict.name} — ${rel.conflict.desc}

📊 候補スコア（上位3）
${candidates.slice(0,3).map(c=>`${c.key} ${(c.score*100).toFixed(1)}%`).join("\n")}

🔒 信頼度: ${confidence}
`;

  const card = document.getElementById('resultCard');
  card.dataset.share = share;
  renderResultView();
}

/* ---------- 結果描画 ---------- */
function renderResultView() {
  if (!lastResult) return;
  const { t, rel, d, tKey, candidates, confidence } = lastResult;
  const html = [];

  html.push(`<h2>あなたは <b>「${t.name}」</b> タイプ</h2>`);
  html.push(`<p class="muted">(ソシオニクス表記: <b>${tKey}</b>)</p>`);
  html.push(`<p>${d.intro}</p>`);
  html.push(`<h3>🌟 強み</h3><ul>${d.strength.map(x=>`<li>${x}</li>`).join('')}</ul>`);
  html.push(`<h3>⚠️ 弱み</h3><ul>${d.weak.map(x=>`<li>${x}</li>`).join('')}</ul>`);
  html.push(`<h3>🤝 相性</h3>
    <ul>
      <li><b>デュアル:</b> ${rel.dual.name} ― ${rel.dual.desc}</li>
      <li><b>同クアドラ:</b><br>${rel.same.map(x=>`・${x.name} ― ${x.desc}`).join("<br>")}</li>
      <li><b>コンフリクト:</b> ${rel.conflict.name} ― ${rel.conflict.desc}</li>
    </ul>`);
  html.push(`<h3>📊 候補スコア</h3><ol>${candidates.slice(0,3).map(c=>`<li>${c.key} (${(c.score*100).toFixed(1)}%)</li>`).join('')}</ol>`);
  html.push(`<h3>🔒 信頼度: ${confidence}</h3>`);

  const card = document.getElementById('resultCard');
  card.innerHTML = html.join('');
  card.style.display = 'block';
}

/* ---------- UI制御 ---------- */
let current = [], answers = {}, lastResult = null;

function setMode(mode) {
  current = (mode === '24') ? Q24 : Q60;
  document.getElementById('modeLabel').textContent = (mode === '24') ? '24問版（改良）' : '60問版（じっくり）';
  answers = {};
  document.getElementById('questionCard').innerHTML = current.map((q,i)=>`
    <div class="q" id="${q.id}">
      <div class="qtitle">Q${i+1}. ${q.text}</div>
      <div class="slider">
        <span>-5</span>
        <input type="range" min="-5" max="5" step="1" value="0"
          oninput="answers['${q.id}']=Number(this.value);updateProgress()">
        <span>+5</span>
      </div>
    </div>
  `).join('');
  updateProgress();
  document.getElementById('resultCard').style.display = 'none';
  document.getElementById('resultCard').dataset.share = '';
  document.getElementById('warnMsg').textContent = '';
}

function updateProgress() {
  const answered = Object.keys(answers).length;
  const total = current.length || 0;
  const progress = total ? Math.round((answered/total)*100) : 0;
  document.getElementById('bar').style.width = progress + '%';
  document.getElementById('count').textContent = `${answered}/${total} 回答（${progress}%）`;
}

function tryShowResult() {
  const unanswered = current.filter(q => answers[q.id] === undefined);
  if (unanswered.length > 0) {
    document.getElementById('warnMsg').textContent = `⚠ 未回答があります（残り ${unanswered.length} 問）`;
    return;
  }
  document.getElementById('warnMsg').textContent = '';
  buildResult();
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text)
    .then(()=>alert('結果をコピーしました！'))
    .catch(()=>alert('コピーに失敗しました'));
}

function init() {
  document.getElementById('mode24').addEventListener('click', ()=>setMode('24'));
  document.getElementById('mode60').addEventListener('click', ()=>setMode('60'));
  document.getElementById('calcBtn').addEventListener('click', tryShowResult);
  document.getElementById('copyBtn').addEventListener('click', ()=>{
    const txt = document.getElementById('resultCard').dataset.share || '';
    if (!txt) { alert('まず結果を表示してください。'); return; }
    copyToClipboard(txt);
  });
  setMode('24');
}

document.addEventListener('DOMContentLoaded', init);
</script>















